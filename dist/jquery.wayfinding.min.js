/*! wayfinding - v0.4.0 - 2015-02-11
* https://github.com//wayfinding
* Copyright (c) 2015 Regents of the University of California Licensed MIT */
!function(a){"use strict";var b,c={maps:[{path:"floorplan.svg",id:"map.1"}],path:{color:"red",radius:10,speed:8,width:3},startpoint:function(){return"startpoint"},endpoint:!1,accessibleRoute:!1,defaultMap:function(){return"map.1"},loadMessage:"Loading",dataStoreCache:null,showLocation:!1,locationIndicator:{fill:"red",height:40},pinchToZoom:!1,zoomToRoute:!0,zoomPadding:25,floorChangeAnimationDelay:1250};a.fn.wayfinding=function(d,e,f){function g(a){return a.replace(/(:|\.|\[|\])/g,"\\$1")}function h(a,b,c,d){return(d-c)/d*a+c/d*b}function i(a){this.value=a,this.message=" no maps identified in collection to load",this.toString=function(){return this.value+this.message}}function j(a){this.value=a,this.message=" has duplicate map ids",this.toString=function(){return this.value+this.message}}function k(a){this.value=a,this.message=" wasn't in the list of maps",this.toString=function(){return this.value+this.message}}function l(b){var c,d,f,g=!1,h=!1;if(f=a(b).find("div").hide().end().append('<div id="WayfindingStatus" style="">'+e.loadMessage+"</div>"),!(L.length>0))throw a(f).text(e.errorMessage),new i(JSON.stringify(L));for(c=0;c<L.length;c++)for(d=c;d<L.length;d++)c!==d&&L[c].id===L[d].id&&(g=!0);if(g===!0)throw a(f).text(e.errorMessage),new j(JSON.stringify(L));for(c=0;c<L.length;c++)L[c].id===M&&(h=!0);if(h===!1)throw a(f).text(e.errorMessage),new k(M)}function m(b,c,d){var f,g,h,i,j=e.locationIndicator.height;return f=document.createElementNS("http://www.w3.org/2000/svg","g"),a(f).attr("class",d),g=document.createElementNS("http://www.w3.org/2000/svg","path"),h=document.createElementNS("http://www.w3.org/2000/svg","circle"),i="M0.075,0",i+="c-2.079-10.207-5.745-18.703-10.186-26.576c-3.295-5.84-7.111-11.23-10.642-16.894c-1.179-1.891-2.196-3.888-3.327-5.85",i+="c-2.266-3.924-4.102-8.472-3.984-14.372c0.113-5.766,1.781-10.391,4.186-14.172c3.954-6.219,10.578-11.317,19.465-12.657",i+="c7.268-1.095,14.08,0.756,18.911,3.58c3.948,2.31,7.005,5.394,9.329,9.027c2.426,3.793,4.096,8.274,4.236,14.12",i+="c0.072,2.995-0.418,5.769-1.109,8.069c-0.699,2.328-1.823,4.274-2.824,6.353c-1.953,4.06-4.4,7.777-6.857,11.498",i+="C9.954,-26.789,3.083,-15.486,0.075,0z",g.setAttribute("d",i),g.setAttribute("fill","#E81E25"),g.setAttribute("stroke","#000000"),g.setAttribute("stroke-width","3.7"),g.setAttribute("stroke-miterlimit","10"),h.setAttribute("cx","0"),h.setAttribute("cy","-63.757"),h.setAttribute("r","9.834"),f.appendChild(g),f.appendChild(h),f.setAttribute("transform","translate("+b+" "+(c-10*(j/125))+") scale("+j/125+")"),f}function n(c,d,e){var f,g,h,i,j,k,l,m,n;b.p[c]=[],a("#Paths line",e).each(function(){f={},f.floor=d.id,f.r=1/0,f.p=-1,f.x=a(this).attr("x1"),f.y=a(this).attr("y1"),f.d=[],f.m=a(this).attr("x2"),f.n=a(this).attr("y2"),f.e=[],f.l=Math.sqrt(Math.pow(f.x-f.m,2)+Math.pow(f.y-f.n,2)),f.c=[],f.q=[],b.p[c].push(f)}),a("#Doors line",e).each(function(){h=a(this).attr("x1"),i=a(this).attr("y1"),j=a(this).attr("x2"),k=a(this).attr("y2"),g=a(this).attr("id"),a.each(b.p[c],function(a,b){d.id===b.floor&&(b.x===h&&b.y===i||b.x===j&&b.y===k)?b.d.push(g):d.id===b.floor&&(b.m===h&&b.n===i||b.m===j&&b.n===k)&&b.e.push(g)})}),a("#Portals line",e).each(function(){m={},n=a(this).attr("id"),n&&n.indexOf("_")>-1&&(n=n.slice(0,n.indexOf("_"))),m.id=n,m.type=n.split(".")[0],m.floor=d.id,m.mate=n.split(".").slice(0,2).join(".")+"."+d.id,m.mapNum=c,m.matched=!1,h=a(this).attr("x1"),i=a(this).attr("y1"),j=a(this).attr("x2"),k=a(this).attr("y2"),l=a.grep(b.p[c],function(a){return h===a.x&&i===a.y||h===a.m&&i===a.n}),0!==l.length?(m.x=h,m.y=i):(m.x=j,m.y=k),m.l=Math.sqrt(Math.pow(h-j,2)+Math.pow(i-k,2)),S.push(m)})}function o(){var a,c,d,e,f,g,h,i,j,k;for(a=0;a<S.length;a++)if(d=S[a],d.matched===!1)for(c=a;c<S.length;c++)S[c].id===d.mate&&S[c].mate===d.id&&(e=S[c],f={},d.matched=!0,e.matched=!0,f.t=d.type,f.a="Elev"===f.t||"Door"===f.t?!0:!1,f.f=d.floor,f.g=d.mapNum,f.x=d.x,f.y=d.y,f.c=[],f.j=e.floor,f.k=e.mapNum,f.m=e.x,f.n=e.y,f.d=[],f.l=d.l+e.l,f.r=1/0,f.p=-1,b.q.push(f));for(g=0;g<L.length;g++)for(h=0;h<b.p[g].length-1;h++)for(i=h+1;i<b.p[g].length;i++)(b.p[g][i].x===b.p[g][h].x&&b.p[g][i].y===b.p[g][h].y||b.p[g][i].m===b.p[g][h].x&&b.p[g][i].n===b.p[g][h].y||b.p[g][i].x===b.p[g][h].m&&b.p[g][i].y===b.p[g][h].n||b.p[g][i].m===b.p[g][h].m&&b.p[g][i].n===b.p[g][h].n)&&(b.p[g][h].c.push(i),b.p[g][i].c.push(h));for(j=0;j<b.q.length;j++)for(g=0;g<L.length;g++)for(k=0;k<b.p[g].length;k++)b.q[j].f===b.p[g][k].floor&&(b.q[j].x===b.p[g][k].x&&b.q[j].y===b.p[g][k].y||b.q[j].x===b.p[g][k].m&&b.q[j].y===b.p[g][k].n)?(b.q[j].c.push(k),b.p[g][k].q.push(j)):b.q[j].j===b.p[g][k].floor&&(b.q[j].m===b.p[g][k].x&&b.q[j].n===b.p[g][k].y||b.q[j].m===b.p[g][k].m&&b.q[j].n===b.p[g][k].n)&&(b.q[j].d.push(k),b.p[g][k].q.push(j));S=[]}function p(a){var c,d,e,f,g={paths:[],floor:null};for(c=0;c<L.length;c++)for(d=0;d<b.p[c].length;d++){for(e=0;e<b.p[c][d].d.length;e++)b.p[c][d].d[e]===a&&(g.paths.push(d),g.floor=b.p[c][d].floor);for(f=0;f<b.p[c][d].e.length;f++)b.p[c][d].e[f]===a&&(g.paths.push(d),g.floor=b.p[c][d].floor)}return g}function q(c,d,f,g){a.each(b.p[d][f].c,function(a,e){g+b.p[d][e].l<b.p[d][e].r&&(b.p[d][e].r=g+b.p[d][e].l,b.p[d][e].p=f,b.p[d][e].o=c,q("pa",d,e,b.p[d][e].r))}),b.p[d][f].q.length>0&&a.each(b.p[d][f].q,function(h,i){g+b.q[i].l<b.q[i].r&&(e.accessibleRoute===!1||e.accessibleRoute===!0&&b.q[i].a)&&(b.q[i].r=g+b.q[i].l,b.q[i].p=f,b.q[i].q=d,b.q[i].o=c,-1!==a.inArray(f,b.q[i].c)?a.each(b.q[i].d,function(a,c){g+b.q[i].l+b.p[b.q[i].k][c].l<b.p[b.q[i].k][c].r&&(b.p[b.q[i].k][c].r=b.q[i].r+b.p[b.q[i].k][c].l,b.p[b.q[i].k][c].p=i,b.p[b.q[i].k][c].o="po",q("pa",b.q[i].k,c,b.p[b.q[i].k][c].r))}):a.each(b.q[i].c,function(a,c){g+b.q[i].l+b.p[b.q[i].g][c].l<b.p[b.q[i].g][c].r&&(b.p[b.q[i].g][c].r=b.q[i].r+b.p[b.q[i].g][c].l,b.p[b.q[i].g][c].p=i,b.p[b.q[i].g][c].o="po",q("pa",b.q[i].g,c,b.p[b.q[i].g][c].r))}))})}function r(){var c,d,e;for(c=p(N),d=0;d<L.length;d++)if(L[d].id===c.floor){e=d;break}a.each(c.paths,function(a,c){b.p[e][c].r=b.p[e][c].l,b.p[e][c].p="door",q("pa",e,c,b.p[e][c].l)})}function s(a,c,d){var e;if("door"!==d)switch(e={},e.type=a,e.floor=c,e.segment=d,O.push(e),a){case"pa":s(b.p[c][d].o,c,b.p[c][d].p);break;case"po":s(b.q[d].o,b.q[d].q,b.q[d].p)}}function t(){var a,c,d,f,g,h;for(a=p(e.endpoint),c=0;c<L.length;c++)if(L[c].id===a.floor){d=c;break}for(g=1/0,f=-1,h=0;h<a.paths.length;h++)b.p[d][a.paths[h]].r<g&&(g=b.p[d][a.paths[h]].r,f=a.paths[h]);return-1!==f&&(O=[],s("pa",d,f),O.reverse()),O}function u(){return b={p:[],q:[]},S=[],a.each(L,function(a,b){n(a,b,b.el)}),o(),r(),b}function v(c){if(e.dataStoreCache){if("object"==typeof e.dataStoreCache)console.debug("Using passed dataStoreCache object."),b=e.dataStoreCache,"function"==typeof c&&c();else if("string"==typeof e.dataStoreCache){var d=e.dataStoreCache+N+(e.accessibleRoute?".acc":"")+".json";console.debug("Attempting to load dataStoreCache from URL ...",d),a.getJSON(d,function(a){console.debug("Using dataStoreCache from remote."),b=a,"function"==typeof c&&c()}).fail(function(){console.error("Failed to load dataStore cache from URL. Falling back to client-side dataStore generation."),b=u(),"function"==typeof c&&c()})}}else console.debug('No dataStore cache set, building with startpoint "'+N+'" ...'),b=u(),"function"==typeof c&&c()}function w(b,c){var d,f,h,i,j;if(a("g.startPin",c).remove(),e.startpoint=b,N="function"==typeof e.startpoint?e.startpoint():e.startpoint,e.showLocation){d=a("#Doors #"+g(N),c);var k=c.children().has(a("#"+g(N)));if(f=a("svg",k).children().last(),!d.length)return;h=(Number(d.attr("x1"))+Number(d.attr("x2")))/2,i=(Number(d.attr("y1"))+Number(d.attr("y2")))/2,j=m(h,i,"startPin"),f.after(j)}}function x(b,c){var d,f,h,i,j;if(a("g.destinationPin",c).remove(),e.showLocation){if(d=a("#Doors #"+g(b),c),f=a("svg").has('#Rooms a[id="'+g(b)+'"]'),!d.length)return;h=(Number(d.attr("x1"))+Number(d.attr("x2")))/2,i=(Number(d.attr("y1"))+Number(d.attr("y2")))/2,j=m(h,i,"destinationPin"),f.append(j)}}function y(b){var d=b.data("wayfinding:options");Q=b.data("wayfinding:drawing"),e=a.extend(!0,{},c,e),e=void 0!==d?d:a.extend(!0,{},c,e),e=a.metadata?a.extend(!0,{},e,b.metadata()):e,L=e.maps,M="function"==typeof e.defaultMap?e.defaultMap():e.defaultMap,N="function"==typeof e.startpoint?e.startpoint():e.startpoint}function z(a){a.data("wayfinding:options",e),a.data("wayfinding:drawing",Q),a.data("wayfinding:data",b)}function A(b){var c=a(b).find("svg"),d=parseInt(a(c).attr("height").replace("px","").split(".")[0],10),e=parseInt(a(c).attr("width").replace("px","").split(".")[0],10);d=2*Math.ceil(d/2),e=2*Math.ceil(e/2),a(b).css("padding-bottom",100*(d/e)+"%"),c.attr("height","100%").attr("width","100%").attr("preserveAspectRatio","xMinYMin meet"),a("#Rooms a, #Doors line",b).each(function(){if(a(this).prop("id")&&a(this).prop("id").indexOf("_")>0){var b=a(this).prop("id");a(this).prop("id",b.slice(0,b.indexOf("_")))}})}function B(a){a.panzoom({minScale:1,contain:"invert",cursor:"pointer"}),a.find("a").on("mousedown touchstart",function(a){a.stopImmediatePropagation()})}function C(b,c){a(c).hide(),a("#Paths line",c).attr("stroke-opacity",0),a("#Doors line",c).attr("stroke-opacity",0),a("#Portals line",c).attr("stroke-opacity",0);var d=a("#Paths",c).parent();d.is("g")&&d.attr("opacity",0).attr("display","inline"),a("#Rooms a",c).click(function(c){a(b).trigger("wayfinding:roomClicked",[{roomId:a(this).attr("id")}]),a(b).wayfinding("routeTo",a(this).prop("id")),c.preventDefault()}),a(c).find("*").css("pointer-events","none"),a("#Rooms a",c).find("*").css("pointer-events","auto"),a(b).append(c),e.pinchToZoom&&B(a(c))}function D(b,c){var d=a(c).height();a(c).height(d),a("div",c).hide(),a("#"+b,c).show(0,function(){a(c).trigger("wayfinding:floorChanged",{mapId:b})});var f,g,h,i;if(Q){for(h=-1,f=0;f<L.length;f++)if(L[f]===b){h=f;break}for(g=-1,f=0;f<Q.length;f++)if(Q[f].floor===h){g=f;break}-1!==g&&(i=Q[g].routeLength,a(Q[g].path,c).attr("stroke-dasharray",[i,i]),a(Q[g].path,c).attr("stroke-dashoffset",i),a(Q[g].path,c).attr("pathLength",i),a(Q[g].path,c).attr("stroke-dashoffset",i),a(Q[g].path,c).animate({svgStrokeDashOffset:0},i*e.path.speed))}}function E(b){a("path[class^=directionPath]",b).css({stroke:"none"})}function F(b,c,d,e,f,g){d=parseFloat(d),e=parseFloat(e),f=parseFloat(f),g=parseFloat(g);var h=c.getAttribute("viewBox"),i=parseFloat(h.split(/\s+|,/)[0]),j=parseFloat(h.split(/\s+|,/)[1]),k=parseFloat(h.split(/\s+|,/)[2]),l=parseFloat(h.split(/\s+|,/)[3]),m=a(b).width(),n=a(b).height(),o=Math.min(k/f,l/g);a(b).panzoom("zoom",parseFloat(o));var p=m/k,q=n/l,r=i+k/2,s=j+l/2,t=(r-(d+f/2))*p,u=(s-(e+g/2))*q;a(b).panzoom("pan",t*o,u*o)}function G(b){function c(b,c,d,f,i){setTimeout(function(){var i={};i.X=h(c.X,d.X,b,f),i.Y=h(c.Y,d.Y,b,f),i.W=h(c.W,d.W,b,f),i.H=h(c.H,d.H,b,f),e.pinchToZoom?F(a(g).parent()[0],g,i.X,i.Y,i.W,i.H):g.setAttribute("viewBox",i.X+" "+i.Y+" "+i.W+" "+i.H)},b*(i/f))}function d(c,d,f,i,j){setTimeout(function(){var j={};j.X=h(f.X,d.X,c,i),j.Y=h(f.Y,d.Y,c,i),j.W=h(f.W,d.W,c,i),j.H=h(f.H,d.H,c,i),e.pinchToZoom?F(a(g).parent()[0],g,j.X,j.Y,j.W,j.H):g.setAttribute("viewBox",j.X+" "+j.Y+" "+j.W+" "+j.H),c===i&&b===Q.length&&a(K).trigger("wayfinding:animationComplete")},c*(j/i))}var f,g,i,j,k,l,m,n=e.zoomPadding,o=35,p=650,q={},r={};if(e.repeat&&b>=Q.length)setTimeout(function(){G(0)},5e3);else if(b>=Q.length)return;var s=Q[b][0].floor;if(g=a("#"+L[s].id+" svg")[0],j=Q[b].routeLength,l=j*e.path.speed,D(L[Q[b][0].floor].id,K),f=a("#"+L[Q[b][0].floor].id+" .directionPath"+b)[0],f.style.stroke=e.path.color,f.style.strokeWidth=e.path.width,f.style.transition=f.style.WebkitTransition="none",f.style.strokeDasharray=j+" "+j,f.style.strokeDashoffset=j,i=f.getBBox(),f.style.transition=f.style.WebkitTransition="stroke-dashoffset "+l+"ms linear",f.style.strokeDashoffset="0",e.zoomToRoute===!1)b===Q.length-1&&a(f).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){a(K).trigger("wayfinding:animationComplete")});else for(k=g.getAttribute("viewBox"),q.X=parseFloat(k.split(/\s+|,/)[0]),q.Y=parseFloat(k.split(/\s+|,/)[1]),q.W=parseFloat(k.split(/\s+|,/)[2]),q.H=parseFloat(k.split(/\s+|,/)[3]),r.X=i.x-n>0?i.x-n:0,r.Y=i.y-n>0?i.y-n:0,r.H=i.height+2*n,r.W=i.width+2*n,m=0;o>=m;m++)c(m,q,r,o,p);setTimeout(function(){if(G(++b),e.zoomToRoute)for(m=1===Q.length||Q.length>1&&b===Q.length?0:o;o>=m;m++)d(m,q,r,o,p)},l+e.floorChangeAnimationDelay)}function H(c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,u,v,w,y,z,A,B,C,D,E;if(e.endpoint=c,a("path[class^=directionPath]",K).remove(),a("#Rooms *.wayfindingRoom",K).removeAttr("class"),O=[],N!==c&&(a('#Rooms a[id="'+c+'"] g',K).attr("class","wayfindingRoom"),x(e.endpoint,d),O=t(),-1!==j)){for(k=0,f=0;f<O.length;f++)"po"===O[f].type&&k++;if(Q=new Array(k),Q[0]=[],g={},0===O.length)return void console.warn("Attempting to route with no solution. This should never happen. SVG likely has errors. Destination is: "+c);for(b.p[O[0].floor][O[0].segment].d[0]===N?(g={},g.floor=O[0].floor,g.type="M",g.x=b.p[O[0].floor][O[0].segment].x,g.y=b.p[O[0].floor][O[0].segment].y,g.length=0,Q[0].push(g),g={},g.type="L",g.floor=O[0].floor,g.x=b.p[O[0].floor][O[0].segment].m,g.y=b.p[O[0].floor][O[0].segment].n,g.length=b.p[O[0].floor][O[0].segment].l,Q[0].push(g),Q[0].routeLength=g.length):b.p[O[0].floor][O[0].segment].e[0]===N&&(g={},g.type="M",g.floor=O[0].floor,g.x=b.p[O[0].floor][O[0].segment].m,g.y=b.p[O[0].floor][O[0].segment].n,g.length=0,Q[0].push(g),g={},g.type="L",g.floor=O[0].floor,g.x=b.p[O[0].floor][O[0].segment].x,g.y=b.p[O[0].floor][O[0].segment].y,g.length=b.p[O[0].floor][O[0].segment].l,Q[0].push(g),Q[0].routeLength=g.length),l=1,f=0;k+1>f;f++)for(h=l;h<O.length;h++)"pa"===O[h].type&&(m=b.p[O[h].floor][O[h].segment].x,n=b.p[O[h].floor][O[h].segment].y,o=b.p[O[h].floor][O[h].segment].m,p=b.p[O[h].floor][O[h].segment].n,g={},g.floor=O[h].floor,Q[f].slice(-1)[0].x===m&&Q[f].slice(-1)[0].y===n?(g.x=o,g.y=p):(g.x=m,g.y=n),g.length=b.p[O[h].floor][O[h].segment].l,g.type="L",Q[f].push(g),Q[f].routeLength+=g.length),"po"===O[h].type&&(Q[f+1]=[],Q[f+1].routeLength=0,E="",b.q[O[h].segment].g===b.q[O[h].segment].k?E=b.q[O[h].segment].x===g.x&&b.q[O[h].segment].y===g.y?"B":"A":b.q[O[h].segment].g===O[h].floor?E="A":b.q[O[h].segment].k===O[h].floor&&(E="B"),"A"===E?(g={},g.floor=O[h].floor,g.type="M",g.x=b.q[O[h].segment].x,g.y=b.q[O[h].segment].y,g.length=0,Q[f+1].push(g),Q[f+1].routeLength=g.length):"B"===E&&(g={},g.floor=O[h].floor,g.type="M",g.x=b.q[O[h].segment].m,g.y=b.q[O[h].segment].n,g.length=0,Q[f+1].push(g),Q[f+1].routeLength=g.length),l=h,l++,h=O.length);if(e.path.radius>0)for(i=0;i<Q.length;i++){for(f=1;f<Q[i].length-1;f++)"L"===Q[i][f].type&&"L"===Q[i][f].type&&(q=Q[i][f-1].x-Q[i][f].x,r=Q[i][f-1].y-Q[i][f].y,s=Q[i][f].x-Q[i][f+1].x,u=Q[i][f].y-Q[i][f+1].y,(0===r&&0===u||0===q&&0===s||q/r===s/u&&(0!==q||0!==r||0!==s||0!==u))&&(Q[i][f+1].length=Q[i][f].length+Q[i][f+1].length,Q[i].splice(f,1),f=1));for(f=1;f<Q[i].length-1;f++)"L"===Q[i][f].type&&"L"===Q[i][f].type&&Q[i][f].length>e.path.radius&&Q[i][f+1].length>e.path.radius&&(v=Q[i][f].x,w=Q[i][f].y,y=Q[i][f-1].x,z=Q[i][f-1].y,Q[i][f].x=Number(y)+(v-y)*((Q[i][f].length-e.path.radius)/Q[i][f].length),Q[i][f].y=Number(z)+(w-z)*((Q[i][f].length-e.path.radius)/Q[i][f].length),Q[i][f].length=Q[i][f].length-e.path.radius,A={},A.cx=v,A.cy=w,B=Q[i][f+1].x,C=Q[i][f+1].y,A.x=Number(v)+(B-v)*(e.path.radius/Q[i][f+1].length),A.y=Number(w)+(C-w)*(e.path.radius/Q[i][f+1].length),Q[i][f+1].length=Q[i][f+1].length-e.path.radius,A.type="Q",A.floor=Q[i][f].floor,Q[i].splice(f+1,0,A))}a.each(Q,function(b,c){var d,e="";a.each(c,function(a,b){switch(b.type){case"M":e="M"+b.x+","+b.y;break;case"L":e+="L"+b.x+","+b.y;break;case"Q":e+="Q"+b.cx+","+b.cy+" "+b.x+","+b.y}}),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("d",e),d.style.fill="none",d.classList?d.classList.add("directionPath"+b):d.setAttribute("class","directionPath"+b);var f=a("#"+L[c[0].floor].id+" svg"),g=a(".startPin",f),h=a(".destinationPin",f);g.length?g.before(d):h.length?h.before(d):f.append(d),D=a("#"+L[c[0].floor].id+" svg .directionPath"+b),Q[b].path=D}),G(0)}}function I(b){var c,d;for(a("#WayfindingStatus").remove(),c=0,d=0;d<L.length;d++)M===L[d].id&&(c=d);a("#"+L[c].id,b).show(),a(b).trigger("wayfinding:mapsVisible"),"function"==typeof e.endpoint?H(e.endpoint(),b):"string"==typeof e.endpoint&&H(e.endpoint,b),a.event.trigger("wayfinding:ready")}function J(b,c){var d=0;a('div:not("#WayfindingStatus")',b).remove(),a.each(L,function(e,f){var g=a('<div id="'+f.id+'"></div>');g.load(f.path,function(a,h){"error"===h?(g.html('<p class="text-center text-danger">Map '+e+" Was not found at "+f.path+"<br />Please upload it in the administration section</p>"),L[e].el=g):(L[e].svgHandle=a,L[e].el=g,A(L[e].el),C(b,g),d+=1),d===L.length&&v(function(){w(N,b),z(b),I(b),"function"==typeof c&&c()})})})}var K,L,M,N,O,P,Q,R=e,S=[];return d&&"object"==typeof d&&("function"==typeof e&&(f=e),e=d,R=d,d="initialize"),this.each(function(){if(K=a(this),y(K),d&&"string"==typeof d)switch(d){case"initialize":R&&R.maps?(l(K),J(K,f)):R&&void 0!==R.showLocation&&(e.showLocation=R.showLocation,w(e.startpoint,K));break;case"routeTo":H(R,K);break;case"animatePath":E(K),G(0);break;case"startpoint":void 0===R?P=N:(w(R,K),v(f));break;case"currentMap":void 0===R?P=a("div:visible",K).prop("id"):D(R,K);break;case"accessibleRoute":void 0===R?P=e.accessibleRoute:(e.accessibleRoute=R,v(f));break;case"path":void 0===R?P=e.path:e.path=a.extend(!0,{},e.path,R);break;case"getDataStore":P=JSON.stringify(b);break;case"destroy":a(K).remove()}z(K)}),void 0!==P?P:this}}(jQuery);